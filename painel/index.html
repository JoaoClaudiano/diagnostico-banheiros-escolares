<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Painel TÃ©cnico â€“ Banheiros Escolares</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  padding:20px;
}

h1 {
  text-align:center;
}

.cards {
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap:15px;
  margin-bottom:30px;
}

.card {
  background:#fff;
  padding:20px;
  border-radius:8px;
  text-align:center;
  font-weight:bold;
}

.graficos {
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap:30px;
}

.box {
  background:#fff;
  padding:20px;
  border-radius:8px;
}
</style>
</head>

<body>

<h1>Painel TÃ©cnico â€“ AvaliaÃ§Ã£o SanitÃ¡ria</h1>

<div class="cards">
  <div class="card">ðŸŸ¢ Adequadas<br><span id="ok">0</span></div>
  <div class="card">ðŸŸ  Alerta<br><span id="alerta">0</span></div>
  <div class="card">ðŸ”´ CrÃ­ticas<br><span id="critico">0</span></div>
</div>

<div class="graficos">
  <div class="box">
    <h3>Status das Escolas</h3>
    <canvas id="graficoStatus"></canvas>
  </div>
  
  <div class="box">
  <h3>Tempo em SituaÃ§Ã£o CrÃ­tica (dias)</h3>
  <canvas id="graficoTempoCritico"></canvas>
</div>

  <div class="box">
    <h3>Principais Problemas</h3>
    <canvas id="graficoProblemas"></canvas>
  </div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwIqrAdgd7pLsW0kYAnrrHQ-WrCsnbR4Eh9BpkamYbrKwCOFP5fH6N52HFw2nOz2t2G/exec";

fetch(SCRIPT_URL)
  .then(r => r.json())
  .then(dados => {

    let contagemStatus = { ok:0, alerta:0, critico:0 };
    let problemas = {
      "Mofo / bolor":0,
      "Piso danificado":0,
      "Vazamentos":0,
      "VentilaÃ§Ã£o inadequada":0,
      "Outros":0
    };
    const escolasCriticas = dados.filter(d => d.diasCritico > 0);

new Chart(document.getElementById("graficoTempoCritico"), {
  type: "bar",
  data: {
    labels: escolasCriticas.map(e => e.escola),
    datasets: [{
      label: "Dias em condiÃ§Ã£o crÃ­tica",
      data: escolasCriticas.map(e => e.diasCritico),
      backgroundColor: "#dc3545"
    }]
  },
  options: {
    indexAxis: 'y',
    scales: {
      x: { beginAtZero: true }
    }
  }
});

    dados.forEach(d => {
      if (d.status.includes("adequada")) contagemStatus.ok++;
      else if (d.status.includes("alerta")) contagemStatus.alerta++;
      else if (d.status.includes("crÃ­tica")) contagemStatus.critico++;

      // Se no futuro vocÃª salvar problemas detalhados, aqui jÃ¡ estÃ¡ preparado
      if (d.problema) {
        problemas[d.problema] = (problemas[d.problema] || 0) + 1;
      } else {
        problemas["Outros"]++;
      }
    });

    document.getElementById("ok").innerText = contagemStatus.ok;
    document.getElementById("alerta").innerText = contagemStatus.alerta;
    document.getElementById("critico").innerText = contagemStatus.critico;

    // GrÃ¡fico de barras â€“ Status
    new Chart(document.getElementById("graficoStatus"), {
      type: "bar",
      data: {
        labels: ["Adequadas", "Alerta", "CrÃ­ticas"],
        datasets: [{
          data: [
            contagemStatus.ok,
            contagemStatus.alerta,
            contagemStatus.critico
          ],
          backgroundColor: ["#28a745", "#ffc107", "#dc3545"]
        }]
      }
    });

    // GrÃ¡fico de pizza â€“ Problemas
    new Chart(document.getElementById("graficoProblemas"), {
      type: "pie",
      data: {
        labels: Object.keys(problemas),
        datasets: [{
          data: Object.values(problemas),
          backgroundColor: [
            "#6f42c1",
            "#fd7e14",
            "#20c997",
            "#17a2b8",
            "#adb5bd"
          ]
        }]
      }
    });

  })
  .catch(() => alert("Erro ao carregar dados do painel"));
</script>

</body>
</html>
