<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>AnÃ¡lise Espacial â€“ CheckInfra</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" href="estilo.css">
</head>
<body>

<header>
  <button id="btn-voltar" style="position:absolute;left:16px;top:16px;padding:6px 12px;cursor:pointer;">â¬…ï¸ Voltar</button>
  <div style="text-align:center;">
    ğŸ§­ AnÃ¡lise Espacial â€“ Leitura Territorial ExploratÃ³ria
    <div style="font-size:12px;font-weight:normal;opacity:.9;">
      Indicadores espaciais relativos Ã s condiÃ§Ãµes sanitÃ¡rias das escolas
    </div>
  </div>
  <button id="btn-sidebar" style="position:absolute;right:16px;top:16px;padding:6px 12px;cursor:pointer;">ğŸ“‘ Indicadores</button>
</header>

<!-- Sidebar -->
<div id="sidebar" class="sidebar">
  <button id="close-sidebar" aria-label="Fechar">âœ•</button>
  <nav id="sidebar-menu">
    <ul>
      <li data-indicador="pareto" class="ativa">ğŸ“Š Pareto</li>
      <li data-indicador="densidade-critica">ğŸ“ Densidade CrÃ­tica</li>
      <li data-indicador="concentracao-relativa">ğŸ“ˆ ConcentraÃ§Ã£o Relativa</li>
      <li data-indicador="zonas-prioritarias">ğŸŸ¥ Zonas PrioritÃ¡rias</li>
      <!-- NOVOS INDICADORES ADICIONADOS -->
      <li data-indicador="kde">ğŸ”¥ KDE</li>
      <li data-indicador="gini">âš–ï¸ Gini Espacial</li>
      <li data-indicador="lq">ğŸ“ˆ Location Quotient</li>
      <li data-indicador="moran">ğŸ”— Ãndice de Moran</li>
    </ul>
  </nav>
  <div id="sidebar-content"></div>
</div>

<div class="abas">
  <button class="ativa" onclick="abrirAba('mapa')">ğŸ—ºï¸ Mapa</button>
  <button onclick="abrirAba('ranking')">ğŸ“Š Ranking</button>
  <button onclick="abrirAba('metodologia')">ğŸ“˜ Metodologia</button>
  <button onclick="abrirAba('avancada')">ğŸš€ AnÃ¡lise AvanÃ§ada</button>
</div>

<!-- MAPA -->
<div id="mapa" class="secao ativa">
  <div class="painel">
    <label>
      Indicador:
      <select id="seletorIndicador">
        <option value="1">Indicador 1 â€” Densidade CrÃ­tica</option>
        <option value="2">Indicador 2 â€” ConcentraÃ§Ã£o Relativa</option>
      </select>
    </label>
    <label>
      <input type="checkbox" id="toggleZonas" checked>
      ğŸŸ¥ Zonas prioritÃ¡rias
    </label>
    <label>
      <button id="btn-voronoi" style="margin-left: 10px; padding: 5px 10px; cursor: pointer;">
        ğŸ§© Gerar Voronoi
      </button>
    </label>
  </div>
  <div id="map"></div>
</div>

<!-- RANKING -->
<div id="ranking" class="secao">
  <h3>ğŸ“Š Ranking Territorial â€” Zonas PrioritÃ¡rias</h3>
  <ol id="listaRanking"></ol>
</div>

<!-- METODOLOGIA -->
<div id="metodologia" class="secao">
  <h3>ğŸ“˜ Metodologia e Indicadores</h3>
  <div class="metodologia-content">
    <h4>ğŸ“‹ Indicadores DisponÃ­veis:</h4>
    <ul>
      <li><strong>ğŸ“Š Pareto</strong>: Identifica os 20% de escolas que concentram 80% dos problemas</li>
      <li><strong>ğŸ“ Densidade CrÃ­tica</strong>: Mede a concentraÃ§Ã£o espacial de ocorrÃªncias</li>
      <li><strong>ğŸ“ˆ ConcentraÃ§Ã£o Relativa</strong>: Compara densidade local com mÃ©dia global</li>
      <li><strong>ğŸŸ¥ Zonas PrioritÃ¡rias</strong>: Ãreas com mÃºltiplas vulnerabilidades sobrepostas</li>
      <li><strong>ğŸ”¥ KDE</strong>: Kernel Density Estimation para identificaÃ§Ã£o de hotspots</li>
      <li><strong>âš–ï¸ Gini Espacial</strong>: Mede desigualdade na distribuiÃ§Ã£o espacial</li>
      <li><strong>ğŸ“ˆ Location Quotient</strong>: Identifica especializaÃ§Ã£o regional</li>
      <li><strong>ğŸ”— Ãndice de Moran</strong>: Detecta autocorrelaÃ§Ã£o espacial</li>
    </ul>
    
    <h4>ğŸ¯ Metodologia:</h4>
    <p>As anÃ¡lises sÃ£o exploratÃ³rias e baseadas em:</p>
    <ol>
      <li>Dados geoespaciais das escolas</li>
      <li>Indicadores de condiÃ§Ãµes sanitÃ¡rias</li>
      <li>AnÃ¡lises estatÃ­sticas espaciais</li>
      <li>VisualizaÃ§Ã£o interativa</li>
    </ol>
    <p><em>âš ï¸ As anÃ¡lises nÃ£o substituem vistorias tÃ©cnicas presenciais.</em></p>
  </div>
</div>

<!-- ANÃLISE AVANÃ‡ADA -->
<div id="avancada" class="secao">
  <h3>ğŸš€ AnÃ¡lise AvanÃ§ada</h3>
  <div class="avancada-content">
    <div class="avancada-grid">
      <div class="avancada-card">
        <h4>ğŸ§© Diagrama de Voronoi</h4>
        <p>Particiona o territÃ³rio em Ã¡reas de influÃªncia para cada escola.</p>
        <button id="btn-analise-voronoi" class="btn-avancada">Gerar Voronoi</button>
        <div id="voronoi-container" class="avancada-output"></div>
      </div>
      
      <div class="avancada-card">
        <h4>ğŸ“ AnÃ¡lise de Impacto</h4>
        <p>Calcula raio de impacto baseado na severidade dos problemas.</p>
        <label>Raio de Impacto (metros): 
          <input type="range" id="raio-impacto" min="100" max="2000" value="500">
          <span id="raio-value">500m</span>
        </label>
        <button id="btn-calcular-impacto" class="btn-avancada">Calcular Impacto</button>
        <div id="impacto-container" class="avancada-output"></div>
      </div>
      
      <div class="avancada-card">
        <h4>ğŸ“ˆ EstatÃ­sticas AvanÃ§adas</h4>
        <p>MÃ©tricas estatÃ­sticas para tomada de decisÃ£o.</p>
        <div id="estatisticas-container" class="avancada-output">
          <p>Clique em "Calcular" para gerar estatÃ­sticas.</p>
        </div>
        <button id="btn-calcular-estatisticas" class="btn-avancada">Calcular EstatÃ­sticas</button>
      </div>
    </div>
    
    <div class="avancada-map">
      <h4>ğŸ—ºï¸ Mapa de AnÃ¡lise AvanÃ§ada</h4>
      <div id="mapa-avancado" style="height: 400px; border-radius: 8px; margin-top: 10px;"></div>
    </div>
  </div>
</div>

<footer>
  Â© 2026 CheckInfra â€” CÃ³digo MIT | ğŸ”’ LGPD conforme lei nÂº 13.709/2018
  <div style="font-size: 11px; margin-top: 5px; opacity: 0.8;">
    v2.0 | AnÃ¡lise Espacial com 8 indicadores integrados
  </div>
</footer>

<!-- Scripts -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

<!-- Bibliotecas para Voronoi e anÃ¡lise espacial -->
<script src="https://cdn.jsdelivr.net/npm/d3-delaunay@6"></script>

<!-- Scripts principais -->
<script src="abas.js"></script>
<script src="recalculos.js"></script>
<script src="mapa.js"></script>
<script src="eventos.js"></script>
<script src="sidebar.js"></script>

<!-- Scripts de anÃ¡lise avanÃ§ada -->
<script src="analise-avancada.js"></script>
<script src="voronoi-impacto.js"></script>
<script src="mapa-voronoi.js"></script>

<!-- ConfiguraÃ§Ã£o inicial -->
<script>
// Handler para botÃ£o voltar
document.getElementById('btn-voltar').addEventListener('click', function() {
  if (window.history.length > 1) {
    window.history.back();
  } else {
    window.location.href = '/';
  }
});

// Adiciona a aba "AnÃ¡lise AvanÃ§ada" Ã  funÃ§Ã£o abrirAba
function abrirAba(nome) {
  // Esconde todas as seÃ§Ãµes
  document.querySelectorAll('.secao').forEach(sec => {
    sec.classList.remove('ativa');
  });
  
  // Remove ativa de todos os botÃµes
  document.querySelectorAll('.abas button').forEach(btn => {
    btn.classList.remove('ativa');
  });
  
  // Mostra a seÃ§Ã£o correspondente
  const secao = document.getElementById(nome);
  if (secao) {
    secao.classList.add('ativa');
    
    // Ativa o botÃ£o correspondente
    document.querySelectorAll('.abas button').forEach(btn => {
      if (btn.textContent.includes(nome === 'mapa' ? 'ğŸ—ºï¸' : 
                                   nome === 'ranking' ? 'ğŸ“Š' : 
                                   nome === 'metodologia' ? 'ğŸ“˜' : 'ğŸš€')) {
        btn.classList.add('ativa');
      }
    });
    
    // Se for a aba de mapa, garante que o mapa seja redimensionado
    if (nome === 'mapa') {
      setTimeout(() => {
        if (window.map) {
          window.map.invalidateSize();
        }
      }, 300);
    }
    
    // Se for a aba avanÃ§ada, inicializa o mapa avanÃ§ado
    if (nome === 'avancada') {
      setTimeout(() => {
        if (typeof inicializarMapaAvancado === 'function') {
          inicializarMapaAvancado();
        }
      }, 300);
    }
  }
}

// InicializaÃ§Ã£o quando a pÃ¡gina carrega
document.addEventListener('DOMContentLoaded', function() {
  console.log('AnÃ¡lise Espacial v2.0 carregada');
  console.log('Indicadores disponÃ­veis: Pareto, Densidade CrÃ­tica, ConcentraÃ§Ã£o Relativa, Zonas PrioritÃ¡rias, KDE, Gini, LQ, Moran');
});
</script>

</body>
</html>