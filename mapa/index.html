<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Mapa Sanit√°rio ‚Äì Escolas Municipais</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Leaflet -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
}

header {
  padding: 12px;
  background: #1f4fd8;
  color: white;
  text-align: center;
  font-weight: bold;
}

#map {
  height: calc(100vh - 50px);
}

.legenda {
  position: absolute;
  bottom: 20px;
  left: 20px;
  background: white;
  padding: 10px;
  border-radius: 6px;
  font-size: 14px;
  box-shadow: 0 0 8px rgba(0,0,0,0.2);
}

.legenda div {
  margin-bottom: 5px;
}

.bola {
  display: inline-block;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  margin-right: 6px;
}
.verde { background: green; }
.laranja { background: orange; }
.vermelho { background: red; }
</style>
</head>

<body>

<header>
Mapa Sanit√°rio das Escolas ‚Äì Secretaria de Educa√ß√£o
</header>

<div id="map"></div>

<div class="legenda">
  <div><span class="bola verde"></span> Condi√ß√£o adequada</div>
  <div><span class="bola laranja"></span> Situa√ß√£o de alerta</div>
  <div><span class="bola vermelho"></span> Condi√ß√£o cr√≠tica</div>
</div>

<script>
// üëâ COLE A MESMA URL /exec DO APPS SCRIPT
const API_URL = "https://script.google.com/macros/s/AKfycbzJrWBtziBLKneO3MvQKeFLS7XsMccKKJKzbuY26GxatQxRf_60BoyxAvIFe0JwjxWn/exec";

// Mapa centrado em Fortaleza
const map = L.map("map").setView([-3.7319, -38.5267], 12);

// OpenStreetMap
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "¬© OpenStreetMap"
}).addTo(map);

// Cores por status
function corPorStatus(status) {
  if (status.includes("cr√≠tica")) return "red";
  if (status.includes("alerta")) return "orange";
  return "green";
}

// Carregar dados do banco
fetch(API_URL)
  .then(res => res.json())
  .then(dados => {
    dados.forEach(e => {
      if (!e.lat || !e.lng) return;

      const cor = corPorStatus(e.status);

      L.circleMarker([e.lat, e.lng], {
        radius: 8,
        color: cor,
        fillColor: cor,
        fillOpacity: 0.8
      })
      .addTo(map)
      .bindPopup(`
        <strong>${e.escola}</strong><br>
        Status: ${e.status}<br>
        Pontua√ß√£o: ${e.pontuacao}
      `);
    });
  })
  .catch(err => {
    alert("Erro ao carregar dados do mapa");
    console.error(err);
  });
</script>

</body>
</html>
