<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <script src="https://unpkg.com/leaflet-omnivore/leaflet-omnivore.min.js"></script>
<meta charset="UTF-8">
<title>Mapa da Secretaria</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
#map{ height:100vh; }
</style>
</head>

<body>
<div id="map"></div>

<script>
const map = L.map("map").setView([-3.7319, -38.5267], 12);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "¬© OpenStreetMap"
}).addTo(map);

// üîπ L√™ avalia√ß√µes salvas
const avaliacoes = JSON.parse(localStorage.getItem("avaliacoes")) || [];

// üîπ Carrega o KML oficial das escolas
omnivore.kml("escolas.kml")
  .on("ready", function () {

    this.eachLayer(layer => {
      const nomeEscola = layer.feature.properties.name;

      // procura avalia√ß√£o correspondente
      const registro = avaliacoes.find(a =>
        a.escola.toLowerCase() === nomeEscola.toLowerCase()
      );

      let cor = "gray";
      let statusTxt = "Sem avalia√ß√£o";

      if (registro) {
        cor = registro.status === "adequado" ? "green" :
              registro.status === "alerta" ? "orange" : "red";
        statusTxt = registro.status;
      }

      layer.setStyle({
        color: cor,
        fillColor: cor,
        fillOpacity: 0.8
      });

      layer.bindPopup(`
        <strong>${nomeEscola}</strong><br>
        Status: ${statusTxt}
      `);
    });

  })
  .addTo(map);
</script>

</body>
</html>


