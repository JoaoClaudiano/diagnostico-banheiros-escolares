<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mapa Sanit√°rio ‚Äì CheckInfra</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>

<style>
body { margin:0; font-family:Arial,sans-serif; background:#f4f6f8; }

header {
  background:#1f4fd8;
  color:#fff;
  padding:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  position:sticky;
  top:0;
  z-index:1000;
}
header .voltar { position:absolute; left:14px; cursor:pointer; font-size:18px; user-select:none; }

footer {
  background:#f4f6f8;
  font-size:11px;
  color:#555;
  padding:8px;
  text-align:center;
  border-top:1px solid #ddd;
}

.painel {
  background:#fff;
  padding:8px;
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  justify-content:center;
  border-bottom:1px solid #ddd;
  position:sticky;
  top:52px;
  z-index:999;
  font-size:13px;
}
.painel label { display:flex; align-items:center; gap:4px; cursor:pointer; }

.bola { width:12px; height:12px; border-radius:50%; }
.verde { background:#4CAF50; }
.amarelo { background:#FFD700; }
.laranja { background:#FF9800; }
.vermelho { background:#F44336; }

#map { height: calc(100vh - 160px); }

/* Legenda estilo base */
.legenda-mapa {
  position: fixed;
  top: 50%;
  right: 10px;
  transform: translateY(-50%);
  background: rgba(255,255,255,0.95);
  padding: 14px 16px 12px 16px;
  border-radius: 8px;
  box-shadow: 0 0 15px rgba(0,0,0,0.2);
  font-size: 13px;
  color: #333;
  z-index: 1000;
  max-width: 240px;
  transition: transform 0.3s ease, right 0.3s ease;
}

.legenda-mapa h3 {
  margin:0;
  font-size:14px;
  font-weight:bold;
  display:flex;
  align-items:center;
  justify-content: space-between;
}

.legenda-mapa i {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  display: inline-block;
  margin-right: 6px;
}

#toggleLegenda {
  cursor:pointer;
  font-weight:bold;
  background:#ddd;
  border:none;
  border-radius:4px;
  width:28px;
  height:28px;
  font-size:18px;
  display:flex;
  align-items:center;
  justify-content:center;
  margin-right:6px;
}

.legenda-oculta { display:none; }

.legenda-btn-abrir {
  position: fixed;
  top: 50%;
  left: 0;
  transform: translateY(-50%);
  background: #1f4fd8;
  color: #fff;
  border-radius: 0 4px 4px 0;
  width: 36px;
  height: 36px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  cursor:pointer;
  z-index:1001;
}

/* Media query para celular */
@media (max-width:600px){
  .legenda-mapa { max-width: 180px; padding: 10px 12px; font-size:12px; }
  #toggleLegenda { width:32px; height:32px; font-size:16px; }
  .legenda-btn-abrir { width:32px; height:32px; font-size:16px; }
}
</style>
</head>

<body>
<header>
  <span class="voltar" onclick="history.back()">‚Üê</span>
  <span>Mapa Sanit√°rio das Escolas ‚Äì CheckInfra</span>
</header>

<div class="painel">
  <label><input type="checkbox" id="fAdequado" checked><span class="bola verde"></span>Adequado</label>
  <label><input type="checkbox" id="fAlerta" checked><span class="bola amarelo"></span>Alerta</label>
  <label><input type="checkbox" id="fAtencao" checked><span class="bola laranja"></span>Aten√ß√£o</label>
  <label><input type="checkbox" id="fCritico" checked><span class="bola vermelho"></span>Cr√≠tico</label>
</div>

<div id="map"></div>

<!-- Legenda -->
<div class="legenda-mapa" id="legendaBairros">
  <h3>
    <button id="toggleLegenda">√ó</button>
    Status dos bairros
  </h3>
  <div style="margin-top:8px; font-size:13px; line-height:1.4;">
    <div>üî¥ Cr√≠tico: Predom√≠nio de falhas graves ou risco iminente.</div>
    <div>üü† Aten√ß√£o: Unidade com tend√™ncia de degrada√ß√£o.</div>
    <div>üü° Alerta: Necessidade de manuten√ß√£o preventiva e pontual.</div>
    <div>üü¢ Adequado: Padr√£o dentro das normas vigentes.</div>
    <hr style="margin:6px 0">
    <div style="font-size:12px; color:#555;">*Se ‚â•50% das escolas no bairro est√£o em determinada classe, essa ser√° predominante.</div>
  </div>
</div>

<!-- Bot√£o de abrir legenda -->
<div class="legenda-btn-abrir legenda-oculta" id="btnAbrirLegenda">‚ñ∂</div>

<footer>
  Visualiza√ß√£o territorial para apoio √† decis√£o. N√£o substitui inspe√ß√£o t√©cnica presencial.
</footer>

<script>
const legenda = document.getElementById("legendaBairros");
const btnAbrir = document.getElementById("btnAbrirLegenda");
const toggleBtn = document.getElementById("toggleLegenda");

// Fechar legenda
toggleBtn.addEventListener("click", ()=>{
  legenda.style.display = "none";
  btnAbrir.classList.remove("legenda-oculta");
});

// Abrir legenda
btnAbrir.addEventListener("click", ()=>{
  legenda.style.display = "block";
  btnAbrir.classList.add("legenda-oculta");
});
</script>
</body>
</html>